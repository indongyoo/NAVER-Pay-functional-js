<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2.1</title>
</head>
<body>

<script>
const {log, clear, dir} = console;

const L = {};

L.map = function* (f, iter) {
  for (const a of iter) {
    yield f(a);
  }
};

L.filter = function* (f, iter) {
  for (const a of iter) {
    if (f(a)) yield a;
  }
};

L.range = function* (start, stop) {
  while (start < stop) {
    yield start++;
  }
};

L.take = function* (l, iter) {
  for (const a of iter) {
    yield a;
    if (--l == 0) break;
  }
};

function map(..._) {
  return [...L.map(..._)];
}

function filter(..._) {
  return [...L.filter(..._)];
}

function take(..._) {
  return [...L.take(..._)];
}

function range(..._) {
  return [...L.range(..._)];
}

const add = (a, b) => a + b;
</script>

1. 축약하는 함수 reduce
- reduce
- add
<script>
function reduce(f, acc, iter) {
  if (arguments.length == 2) {
    iter = acc[Symbol.iterator]();
    acc = iter.next().value;
  }
  for (const a of iter) {
    acc = f(acc, a);
  }
  return acc;
}
log(reduce(add, 10, [1, 2, 3]));
// add(add(add(10, 1), 2), 3);

log(reduce(add, [1, 2, 3, 4]));
log(reduce(add, 1, [2, 3, 4]));
// add(add(add(1, 2), 3), 4);
</script>
- count
<script>
const inc = (obj, k) => {
  obj[k] = (obj[k] || 0) + 1;
  return obj;
};
const count = iter => reduce(inc, {}, iter);
log(count([1, 2, 3, 4, 5, 1, 2, 5, 5]));
// {1: 2, 2: 2, 3: 1, 4: 1, 5: 3}

// log(count(document.querySelectorAll('*')));
// 실패
</script>

- countByKey
<script>
const users = [
  { name: 'aa', age: 23 },
  { name: 'bb', age: 25 },
  { name: 'aa', age: 25 },
  { name: 'ab', age: 18 },
  { name: 'bB', age: 18 }
];

const countByKey = (k, iter) =>
  reduce((obj, v) => inc(obj, v[k]), {}, iter);

log(countByKey('name', users));
log(countByKey('age', users));
</script>
- 값 보다 함수, countBy

<script>
const countBy = (f, iter) =>
  reduce((obj, v) => inc(obj, f(v)), {}, iter);

log(countBy(u => u.name, users));
log(countBy(u => u.age, users));
log(countBy(u => u.name[0], users));
log(countBy(u => u.name.toUpperCase(), users));
log(countBy(u => u.age - u.age % 10, users));

log(countBy(a => a, [1,2,3,3,3,4,4]));
log(countBy(a => a % 2 ? 'odd' : 'even', [1,2,3,3,3,4,4]));
</script>

- groupBy

2. 함수를 다루는 함수
- go
- pipe
- curry

3. 2차원 배열 다루기 flat
- L.flat
<script>
</script>

4. 리얼월드
- users
<script type="module">
const users = [
  { name: 'a', age: 21, family: [
    { name: 'a1', age: 53 }, { name: 'a2', age: 47 },
    { name: 'a3', age: 16 }, { name: 'a4', age: 14 }
  ] },
  { name: 'b', age: 24, family: [
    { name: 'b1', age: 58 }, { name: 'b2', age: 51 },
    { name: 'b3', age: 10 }, { name: 'b4', age: 22 }
  ] },
  { name: 'c', age: 31, family: [
    { name: 'c1', age: 64 }, { name: 'c2', age: 62 }
  ] },
  { name: 'd', age: 20, family: [
    { name: 'd1', age: 42 }, { name: 'd2', age: 42 },
    { name: 'd3', age: 11 }, { name: 'd4', age: 7 }
  ] }
];
</script>

- DOM findAll(sel, els)
<script type="module">
</script>

</body>
</html>